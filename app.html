<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Calibrated Ops | Pro</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>‚öôÔ∏è</text></svg>">
    <link href="https://fonts.googleapis.com/css2?family=Roboto+Mono:wght@400;700&family=Montserrat:wght@400;600&display=swap" rel="stylesheet">
    <style>
        /* --- APP STYLING --- */
        :root {
            --bg-color: #0a192f;
            --card-bg: #112240;
            --primary: #00e5ff;
            --secondary: #8892b0;
            --danger: #ff5252;
            --success: #00e676;
            --warning: #ffab00;
            --text: #e6f1ff;
        }

        body {
            background-color: var(--bg-color);
            color: var(--text);
            font-family: 'Montserrat', sans-serif;
            margin: 0;
            padding: 0;
            padding-bottom: 90px;
            -webkit-font-smoothing: antialiased;
        }

        /* App Header */
        header {
            background: rgba(17, 34, 64, 0.95);
            padding: 15px 20px;
            text-align: center;
            border-bottom: 2px solid var(--primary);
            position: sticky;
            top: 0;
            z-index: 100;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        h1 { margin: 0; font-size: 1.1rem; font-weight: 700; font-family: 'Roboto Mono', monospace; }
        .home-link { text-decoration: none; color: var(--primary); font-size: 1.5rem; }

        /* Navigation Bar (Bottom) */
        .nav-bar {
            position: fixed;
            bottom: 0;
            width: 100%;
            background: #020c1b;
            display: flex;
            justify-content: space-around;
            padding: 10px 0;
            border-top: 1px solid rgba(255,255,255,0.1);
            z-index: 100;
        }

        .nav-item {
            color: #8892b0;
            text-align: center;
            font-size: 0.7rem;
            cursor: pointer;
            flex: 1;
        }

        .nav-item.active { color: var(--primary); }
        .nav-icon { font-size: 1.2rem; display: block; margin-bottom: 4px; }

        /* Sections */
        .section { display: none; padding: 20px; max-width: 600px; margin: 0 auto; }
        .section.active { display: block; }

        /* Inputs & Cards */
        .input-group {
            margin-bottom: 12px;
            background: var(--card-bg);
            padding: 12px 15px;
            border-radius: 8px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border: 1px solid rgba(255,255,255,0.05);
        }
        
        .label-box { display: flex; flex-direction: column; }
        label { font-size: 0.9rem; font-weight: 600; color: #ccd6f6; }
        .ideal-range { font-size: 0.65rem; color: #8892b0; margin-top: 2px; font-family: 'Roboto Mono', monospace; }
        
        input, select {
            background: transparent;
            border: none;
            color: var(--primary);
            font-family: 'Roboto Mono', monospace;
            font-size: 1.1rem;
            text-align: right;
            outline: none;
            width: 120px;
        }

        /* Buttons */
        .action-btn {
            width: 100%;
            padding: 16px;
            margin-top: 15px;
            background: var(--primary);
            color: #0a192f;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 700;
            font-family: 'Roboto Mono', monospace;
            text-transform: uppercase;
            cursor: pointer;
            box-shadow: 0 4px 15px rgba(0, 229, 255, 0.2);
        }
        
        .copy-btn { 
            background: #112240; 
            border: 1px solid var(--primary); 
            color: var(--primary);
            margin-top: 10px;
            padding: 12px;
            font-size: 0.9rem;
        }
        .copy-btn:active { background: rgba(0, 229, 255, 0.1); }

        /* Results & Dosing */
        .result-box {
            margin-top: 25px; padding: 20px; border-radius: 8px; 
            text-align: center; display: none;
        }
        .lsi-score { font-size: 3rem; font-weight: 700; font-family: 'Roboto Mono', monospace; }
        .lsi-status { font-weight: 700; text-transform: uppercase; letter-spacing: 2px; font-size: 0.9rem; }
        
        .dose-card {
            background: rgba(255,255,255,0.05);
            border-left: 4px solid var(--warning);
            padding: 10px 15px;
            margin-top: 10px;
            text-align: left;
            border-radius: 4px;
        }
        .dose-title { color: var(--warning); font-weight: 700; font-size: 0.8rem; text-transform: uppercase; display: block; margin-bottom: 5px; }
        .dose-text { font-size: 0.9rem; color: #fff; font-family: 'Roboto Mono', monospace; }

        /* Guide & Safety */
        .guide-card {
            background: var(--card-bg); border-left: 4px solid var(--primary);
            padding: 15px; margin-bottom: 15px; border-radius: 4px;
        }
        .guide-title { font-weight: 700; color: var(--text); margin-bottom: 5px; display: block; }
        .checklist-item {
            background: var(--card-bg); margin-bottom: 10px; padding: 15px;
            border-radius: 8px; display: flex; align-items: center; cursor: pointer;
        }
        .checklist-item.checked .check-circle { background: var(--success); border-color: var(--success); color: #000; }
        .checklist-item.checked .check-circle::after { content: '‚úì'; font-weight: 700; }
        .check-circle {
            width: 24px; height: 24px; border: 2px solid #8892b0; border-radius: 50%;
            margin-right: 15px; display: flex; align-items: center; justify-content: center;
        }
        
        /* Side Effects Table */
        .chem-table { width: 100%; border-collapse: collapse; margin-top: 10px; font-size: 0.8rem; }
        .chem-table th { text-align: left; color: var(--primary); padding-bottom: 8px; border-bottom: 1px solid #333; }
        .chem-table td { padding: 8px 0; color: #a8b2d1; border-bottom: 1px solid rgba(255,255,255,0.05); }
        .chem-name { font-weight: 700; color: #fff; }
        .chem-effect { color: var(--warning); }

    </style>
</head>
<body>

    <header>
        <h1>CALIBRATED OPS</h1>
        <a href="index.html" class="home-link">‚úï</a>
    </header>

    <div id="tab-lsi" class="section active">
        
        <div class="input-group" style="border-color: var(--primary);">
            <div class="label-box">
                <label style="color:var(--primary)">Pool Volume (gal)</label>
                <span class="ideal-range">Required for dosing</span>
            </div>
            <input type="number" id="vol" value="15000" step="1000">
        </div>

        <div style="height: 1px; background: rgba(255,255,255,0.1); margin: 20px 0;"></div>

        <div class="input-group">
            <div class="label-box"><label>Free Chlorine</label><span class="ideal-range">Ideal: 2.0 - 4.0</span></div>
            <input type="number" id="fc" placeholder="3.0" step="0.5">
        </div>
        <div class="input-group">
            <div class="label-box"><label>pH</label><span class="ideal-range">Ideal: 7.4 - 7.6</span></div>
            <input type="number" id="ph" placeholder="7.5" step="0.1">
        </div>
        <div class="input-group">
            <div class="label-box"><label>Water Temp (¬∞F)</label></div>
            <input type="number" id="temp" placeholder="80" value="80">
        </div>
        <div class="input-group">
            <div class="label-box"><label>Alkalinity (TA)</label><span class="ideal-range">Ideal: 80 - 120</span></div>
            <input type="number" id="ta" placeholder="100" step="10">
        </div>
        <div class="input-group">
            <div class="label-box"><label>Calcium (CH)</label><span class="ideal-range">Ideal: 200 - 400</span></div>
            <input type="number" id="ch" placeholder="300" step="10">
        </div>
        <div class="input-group">
            <div class="label-box"><label>CYA (Stab)</label><span class="ideal-range">Ideal: 30 - 50</span></div>
            <input type="number" id="cya" placeholder="50" step="10">
        </div>
        <div class="input-group">
            <div class="label-box"><label>TDS / Salt</label><span class="ideal-range">Salt Pool: ~3000</span></div>
            <input type="number" id="tds" placeholder="1000" step="100">
        </div>

        <button class="action-btn" onclick="calculateLSI()">CALCULATE & DOSE</button>

        <button class="action-btn copy-btn" onclick="copyReadings()">üìÑ COPY TEST RESULTS</button>

        <div id="result" class="result-box">
            <div id="lsi-val" class="lsi-score">0.00</div>
            <div id="lsi-msg" class="lsi-status">BALANCED</div>
            
            <div id="dosing-plan" style="margin-top:20px;"></div>
            
            <button class="action-btn copy-btn" onclick="copyDosing()">üíä COPY DOSING PLAN</button>
        </div>
    </div>

    <div id="tab-safety" class="section">
        <p style="text-align: center; color: #8892b0; font-size: 0.8rem; margin-bottom: 20px;">SITE SAFETY AUDIT</p>
        <div id="checklist-container"></div>
        
        <button class="action-btn copy-btn" onclick="copySafety()">üõ°Ô∏è COPY SAFETY REPORT</button>
        
        <button class="action-btn" style="background:transparent; border:1px solid var(--danger); color:var(--danger); margin-top:20px;" onclick="resetSafety()">RESET FORM</button>
    </div>

    <div id="tab-vol" class="section">
        <div class="input-group">
            <label>Shape</label>
            <select id="pool-shape" style="text-align:right;">
                <option value="rect">Rectangle</option>
                <option value="round">Round</option>
                <option value="kidney">Kidney/Oval</option>
            </select>
        </div>
        <div class="input-group"><label>Length (ft)</label><input type="number" id="len"></div>
        <div class="input-group"><label>Width (ft)</label><input type="number" id="wid"></div>
        <div class="input-group"><label>Avg Depth (ft)</label><input type="number" id="depth"></div>
        <button class="action-btn" onclick="calcVolume()">CALCULATE GALLONS</button>
        <div id="vol-display" class="vol-result" style="text-align:center; font-size:2rem; margin-top:20px; color:var(--primary); font-family:'Roboto Mono'">0 gal</div>
    </div>

    <div id="tab-guide" class="section">
        
        <h3 style="color:var(--primary); margin-bottom:15px; border-bottom:1px solid #333; padding-bottom:10px;">SENSORY CHECKS</h3>
        <div class="guide-card" style="border-color: #ff5252;">
            <span class="guide-title">STRONG "CHLORINE" SMELL</span>
            <div class="guide-desc"><strong>Diagnosis:</strong> High Combined Chlorine.<br><strong>Fix:</strong> Shock to "Break Point".</div>
        </div>
        <div class="guide-card" style="border-color: #ffab00;">
            <span class="guide-title">BURNING EYES</span>
            <div class="guide-desc"><strong>Diagnosis:</strong> pH Imbalance (not chlorine).<br><strong>Fix:</strong> Check pH (Ideal: 7.5).</div>
        </div>
        
        <h3 style="color:var(--primary); margin:30px 0 15px 0; border-bottom:1px solid #333; padding-bottom:10px;">HIDDEN EFFECTS</h3>
        <div class="guide-card">
            <table class="chem-table">
                <tr><td><span class="chem-name">Trichlor</span></td><td>+ <span class="chem-effect">0.6 ppm CYA</span> / 1ppm Cl</td></tr>
                <tr><td><span class="chem-name">Dichlor</span></td><td>+ <span class="chem-effect">0.9 ppm CYA</span> / 1ppm Cl</td></tr>
                <tr><td><span class="chem-name">Cal Hypo</span></td><td>+ <span class="chem-effect">0.7 ppm Calc</span> / 1ppm Cl</td></tr>
                <tr><td><span class="chem-name">Liquid</span></td><td>+ <span class="chem-effect">1.6 ppm Salt</span> / 1ppm Cl</td></tr>
            </table>
        </div>
    </div>

    <div class="nav-bar">
        <div class="nav-item active" onclick="switchTab('tab-lsi', this)"><span class="nav-icon">‚öóÔ∏è</span>CHEMISTRY</div>
        <div class="nav-item" onclick="switchTab('tab-safety', this)"><span class="nav-icon">üõ°Ô∏è</span>SAFETY</div>
        <div class="nav-item" onclick="switchTab('tab-vol', this)"><span class="nav-icon">üìè</span>VOLUME</div>
        <div class="nav-item" onclick="switchTab('tab-guide', this)"><span class="nav-icon">üìñ</span>GUIDE</div>
    </div>

    <script>
        // --- NAVIGATION ---
        function switchTab(tabId, el) {
            document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
            document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
            document.getElementById(tabId).classList.add('active');
            if(el) el.classList.add('active');
        }

        // --- LSI & DOSING LOGIC ---
        let currentDosingPlan = "Water Balanced."; // Global var to store dosing text

        function calculateLSI() {
            let vol = parseFloat(document.getElementById('vol').value) || 15000;
            let fc = parseFloat(document.getElementById('fc').value) || 0;
            let ph = parseFloat(document.getElementById('ph').value);
            let temp = parseFloat(document.getElementById('temp').value);
            let ch = parseFloat(document.getElementById('ch').value);
            let ta = parseFloat(document.getElementById('ta').value);
            let cya = parseFloat(document.getElementById('cya').value) || 0;
            let tds = parseFloat(document.getElementById('tds').value) || 0;

            if(!ph || !temp || !ch || !ta) { alert("Please enter pH, Temp, Calcium, and Alkalinity."); return; }

            let tf = (temp * 0.01) - 0.1;
            let cf = Math.log10(ch) - 0.4;
            let carbonateAlk = ta - (cya * 0.30);
            if (carbonateAlk < 1) carbonateAlk = 1;
            let af = Math.log10(carbonateAlk);
            let tdsFactor = (tds > 1000) ? 12.2 : 12.1;
            let lsi = ph + tf + cf + af - tdsFactor;

            let resultBox = document.getElementById('result');
            let valDiv = document.getElementById('lsi-val');
            let msgDiv = document.getElementById('lsi-msg');
            let doseDiv = document.getElementById('dosing-plan');
            
            resultBox.style.display = "block";
            valDiv.innerText = lsi.toFixed(2);
            doseDiv.innerHTML = ""; 
            currentDosingPlan = ""; // Reset

            if (lsi >= -0.3 && lsi <= 0.3) {
                valDiv.style.color = "#00e676"; msgDiv.innerText = "BALANCED";
                addDose("Status", "Water is balanced.");
            } else if (lsi < -0.3) {
                valDiv.style.color = "#ff5252"; msgDiv.innerText = "CORROSIVE";
            } else {
                valDiv.style.color = "#ffab00"; msgDiv.innerText = "SCALE FORMING";
            }

            // Dosing Logic
            let vFactor = vol / 10000;

            if (ta < 80) {
                let diff = 100 - ta;
                let lbs = (diff / 10) * 1.5 * vFactor;
                addDose("Low Alkalinity", `Add ${lbs.toFixed(1)} lbs Sodium Bicarb`);
            } else if (ta > 140) {
                 addDose("High Alkalinity", "Add Acid to lower Alk.");
            }

            if (ch < 250) {
                let diff = 300 - ch;
                let lbs = (diff / 10) * 1.25 * vFactor;
                addDose("Low Calcium", `Add ${lbs.toFixed(1)} lbs Calcium Chloride`);
            }

            if (cya < 30) {
                let diff = 50 - cya;
                let lbs = (diff / 10) * 1.3 * vFactor;
                addDose("Low Stabilizer", `Add ${lbs.toFixed(1)} lbs CYA / Conditioner`);
            }

            if (ph > 7.8) {
                let diff = ph - 7.5;
                let quarts = (diff / 0.2) * 1.0 * vFactor;
                addDose("High pH", `Add approx ${quarts.toFixed(1)} quarts Muriatic Acid`);
            } else if (ph < 7.2) {
                addDose("Low pH", "Add Soda Ash or Bicarb if Alk is low.");
            }
        }

        function addDose(title, text) {
            let d = document.createElement('div');
            d.className = 'dose-card';
            d.innerHTML = `<span class="dose-title">${title}</span><span class="dose-text">${text}</span>`;
            document.getElementById('dosing-plan').appendChild(d);
            
            // Append to global text for copy
            currentDosingPlan += `‚Ä¢ ${title}: ${text}\n`;
        }

        // --- COPY FUNCTIONS ---
        
        // 1. Copy Initial Readings
        function copyReadings() {
            let d = new Date().toLocaleDateString();
            let r = `POOL REPORT - ${d}\n\nINITIAL READINGS:\n`;
            r += `‚Ä¢ Free Chlorine: ${document.getElementById('fc').value}\n`;
            r += `‚Ä¢ pH: ${document.getElementById('ph').value}\n`;
            r += `‚Ä¢ Alkalinity: ${document.getElementById('ta').value}\n`;
            r += `‚Ä¢ Calcium: ${document.getElementById('ch').value}\n`;
            r += `‚Ä¢ CYA: ${document.getElementById('cya').value}\n`;
            r += `‚Ä¢ TDS/Salt: ${document.getElementById('tds').value}\n`;
            
            navigator.clipboard.writeText(r).then(() => alert("Readings Copied!"));
        }

        // 2. Copy Dosing Plan
        function copyDosing() {
            let lsi = document.getElementById('lsi-val').innerText;
            let status = document.getElementById('lsi-msg').innerText;
            let r = `TREATMENT LOG\nLSI Status: ${status} (${lsi})\n\nACTIONS TAKEN:\n`;
            
            if(currentDosingPlan === "") r += "‚Ä¢ Water Balanced. No chemicals added.\n";
            else r += currentDosingPlan;
            
            r += `\n- Calibrated Pools`;
            navigator.clipboard.writeText(r).then(() => alert("Dosing Plan Copied!"));
        }

        // 3. Copy Safety Audit
        function copySafety() {
            let items = document.querySelectorAll('.checklist-item');
            let passed = [];
            let failed = [];
            
            items.forEach(item => {
                let text = item.innerText;
                if (item.classList.contains('checked')) passed.push(text);
                else failed.push(text);
            });

            let r = `SAFETY AUDIT REPORT\n\n‚úÖ PASSED:\n`;
            if(passed.length === 0) r += "(None)\n";
            else passed.forEach(p => r += `‚Ä¢ ${p}\n`);

            r += `\n‚ö†Ô∏è NEEDS ATTENTION:\n`;
            if(failed.length === 0) r += "(All Clear)\n";
            else failed.forEach(f => r += `‚Ä¢ ${f}\n`);
            
            navigator.clipboard.writeText(r).then(() => alert("Safety Report Copied!"));
        }


        function calcVolume() {
            let s = document.getElementById('pool-shape').value;
            let l = parseFloat(document.getElementById('len').value)||0; 
            let w = parseFloat(document.getElementById('wid').value)||0; 
            let d = parseFloat(document.getElementById('depth').value)||0;
            let v = 0;
            if(s==='rect') v = l*w*d*7.5;
            else if(s==='round') v = 3.14*(l/2)*(l/2)*d*7.5;
            else v = l*w*d*7.0;
            document.getElementById('vol-display').innerText = Math.round(v).toLocaleString() + " gal";
            document.getElementById('vol').value = Math.round(v);
        }

        const sItems = ["Gates self-closing/latching", "Gate opens OUTWARD", "No gaps > 4in under fence", "Shepherd's Hook present", "Ring Buoy with rope", "Emerg. Phone dial tone", "Main Drain covers secure", "Skimmer baskets intact", "No Diving markers", "Handrails secure"];
        const sCont = document.getElementById('checklist-container');
        sItems.forEach(i => {
            let d=document.createElement('div'); d.className='checklist-item';
            d.onclick=function(){this.classList.toggle('checked');};
            d.innerHTML=`<div class="check-circle"></div><span>${i}</span>`;
            sCont.appendChild(d);
        });
        function resetSafety(){document.querySelectorAll('.checklist-item').forEach(e=>e.classList.remove('checked'));}

    </script>
</body>
</html>
